<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorator="layout/default">
<head lang="en">
    <title>Search Your Images</title>
</head>
<body>
<div class="row" layout:fragment="content">
    <h2 class="indigo-text center">파일 검색</h2>
    <div class="row">
        <form th:action="@{/api/image/search/date}" method="get" class="col m8 s12 offset-m2" id="searchForm">
            <div class="input-field col s9">
                <input type="date" name="date"/>
            </div>
            <div class="input-field col s3">
                <button class="btn light-blue lighten-2 waves-effect waves-light" type="submit">
                    검색<i class="mdi-content-send right"></i>
                </button>
            </div>

        </form>
    </div>
    <div id="contents">


    </div>

    <script type="text/javascript">
        $(document).ready(function(){
            $("#searchForm").on("submit", requestFileInfoList);
        });


        function requestFileInfoList() {

            var data = $(this).serialize();

            $.ajax({
                url:"/api/image/search/date",
                type:"GET",
                contentType:"application/json;charset=UTF-8",
                data: data,
                success:function (response) {

                    console.log(response);
                    handlingResultJson(response)
                }
            });

            return false;
        }

        function handlingResultJson(response) {


            var responseJson = $.parseJSON( JSON.stringify(response));
            var length = responseJson.length;

            var index = 0;
            $("#contents").empty();
            responseJson.forEach(function (fileInfo) {

                if(fileInfo.createdDate == "" || fileInfo.createdDate == null) {
                    fileInfo.createdDate = "날짜정보없음";
                }

                if(fileInfo.createdTime == "" || fileInfo.createdTime == null) {
                    fileInfo.createdTime = "시간정보없음";
                }

                if(fileInfo.position == "" || fileInfo.position == null) {
                    fileInfo.postion = "위치정보없음";
                }

                var newFigure = $("#contentsFigure").clone(true);
                newFigure.attr("style","display:inline-block;");
                newFigure.attr("id", "contentsFigure_"+index);
                newFigure.children("img").attr("src","/uploadedImage/"+fileInfo.fileKey+"_thumbnail");
                newFigure.children("figcaption").children().children("#createdDate").text(fileInfo.createdDate+" "+fileInfo.createdDay);
                newFigure.children("figcaption").children().children("#createdTime").text(fileInfo.createdTime);
                newFigure.children("figcaption").children().children("#position").text(fileInfo.position+" ");
                //newFigure.children("figcaption").children().children("#memo").text(fileInfo.memo+" ");

                $("#contents").append(newFigure);
                index++;


            })
        }
    </script>
</div>
</body>
</html>